"use strict";(self.webpackChunkdongdong_12138_github_io=self.webpackChunkdongdong_12138_github_io||[]).push([[3436],{6038:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>u,frontMatter:()=>t,metadata:()=>l,toc:()=>c});var s=r(5893),o=r(1151);const t={sidebar_position:4},i="Promise \u81ea\u5b9a\u4e49\u5c01\u88c5",l={id:"front-base/Promise/Promise\u81ea\u5b9a\u4e49\u5c01\u88c5",title:"Promise \u81ea\u5b9a\u4e49\u5c01\u88c5",description:"\u6574\u4f53\u7ed3\u6784\u6846\u67b6",source:"@site/docs/front-base/Promise/04-Promise\u81ea\u5b9a\u4e49\u5c01\u88c5.md",sourceDirName:"front-base/Promise",slug:"/front-base/Promise/Promise\u81ea\u5b9a\u4e49\u5c01\u88c5",permalink:"/docs/front-base/Promise/Promise\u81ea\u5b9a\u4e49\u5c01\u88c5",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/front-base/Promise/04-Promise\u81ea\u5b9a\u4e49\u5c01\u88c5.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"front-base",previous:{title:"Promise \u7684\u51e0\u4e2a\u5173\u952e\u95ee\u9898",permalink:"/docs/front-base/Promise/Promise\u7684\u51e0\u4e2a\u5173\u952e\u95ee\u9898"},next:{title:"async \u4e0e await",permalink:"/docs/front-base/Promise/async\u4e0eawait"}},a={},c=[{value:"\u6574\u4f53\u7ed3\u6784\u6846\u67b6",id:"\u6574\u4f53\u7ed3\u6784\u6846\u67b6",level:2},{value:"Promise \u6784\u9020\u51fd\u6570",id:"promise-\u6784\u9020\u51fd\u6570",level:2},{value:"Promise.prototype.then",id:"promiseprototypethen",level:2},{value:"Promise.prototype.catch",id:"promiseprototypecatch",level:2},{value:"Promise.resolve",id:"promiseresolve",level:2},{value:"Promise.reject",id:"promisereject",level:2},{value:"Promise.all",id:"promiseall",level:2},{value:"Promise.race",id:"promiserace",level:2},{value:"\u81ea\u5b9a\u4e49\u51fd\u6570\u5bf9\u8c61\u65b9\u6cd5\uff1aPromise.resolveDelay&amp;Promise.rejectDelay",id:"\u81ea\u5b9a\u4e49\u51fd\u6570\u5bf9\u8c61\u65b9\u6cd5promiseresolvedelaypromiserejectdelay",level:2},{value:"class \u5199\u6cd5",id:"class-\u5199\u6cd5",level:2}];function m(e){const n={code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,o.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"promise-\u81ea\u5b9a\u4e49\u5c01\u88c5",children:"Promise \u81ea\u5b9a\u4e49\u5c01\u88c5"}),"\n",(0,s.jsx)(n.h2,{id:"\u6574\u4f53\u7ed3\u6784\u6846\u67b6",children:"\u6574\u4f53\u7ed3\u6784\u6846\u67b6"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"/**\n * \u81ea\u5b9a\u4e49 Promise \u51fd\u6570\u6a21\u5757\uff1aIIFE\n */\n(function (window) {\n\n  const PENDING = 'pending'\n  const RESOLVED = 'fulfilled'\n  const REJECTED = 'rejected'\n\n  /**\n   * Promise \u6784\u9020\u51fd\u6570\n   * @param {function} executor \u6267\u884c\u5668\u51fd\u6570\uff08\u540c\u6b65\u6267\u884c\uff09(resolve, reject) => {}\n   */\n  function Promise(executor) {\n\n  }\n\n  /**\n   * Promise \u539f\u578b\u5bf9\u8c61\u7684 then \u65b9\u6cd5\n   * \u6307\u5b9a\u6210\u529f\u548c\u5931\u8d25\u7684\u56de\u8c03\u51fd\u6570\n   * @param {function} onResolved \u6210\u529f\u7684\u56de\u8c03\u51fd\u6570(value) => {}\n   * @param {function} onRejected \u5931\u8d25\u7684\u56de\u8c03\u51fd\u6570(reason) => {}\n   * @returns \u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 promise \u5bf9\u8c61\uff0c\u7ed3\u679c\u7531 onResolved/onRejected \u56de\u8c03\u51fd\u6570\u6267\u884c\u7684\u7ed3\u679c\u51b3\u5b9a\n   */\n  Promise.prototype.then = function (onResolved, onRejected) {\n\n  }\n\n  /**\n   * Promise \u539f\u578b\u5bf9\u8c61\u7684 catch \u65b9\u6cd5\n   * \u6307\u5b9a\u5931\u8d25\u7684\u56de\u8c03\u51fd\u6570\n   * @param {function} onRejected \u5931\u8d25\u7684\u56de\u8c03\u51fd\u6570(reason) => {}\n   * @returns \u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 promise \u5bf9\u8c61\n   */\n  Promise.prototype.catch = function (onRejected) {\n\n  }\n\n  /**\n   * Promise\u51fd\u6570\u5bf9\u8c61\u7684 resolve \u65b9\u6cd5\n   * @param {*} value \u6210\u529f\u7684\u503c\n   * @returns \u8fd4\u56de\u4e00\u4e2a\u6210\u529f/\u5931\u8d25\u7684 promise \u5bf9\u8c61\n   */\n  Promise.resolve = function (value) {\n\n  }\n\n  /**\n   * Promise \u51fd\u6570\u5bf9\u8c61\u7684 reject \u65b9\u6cd5\n   * @param {*} resaon \u5931\u8d25\u7684\u539f\u56e0\n   * @returns \u8fd4\u56de\u4e00\u4e2a\u5931\u8d25\u7684 promise \u5bf9\u8c61\n   */\n  Promise.reject = function (resaon) {\n\n  }\n\n  /**\n   * Promise \u51fd\u6570\u5bf9\u8c61\u7684 all \u65b9\u6cd5\n   * @param {Array<Promise>} promises\n   * @returns \u8fd4\u56de\u4e00\u4e2a promise \u5bf9\u8c61\uff0c\u53ea\u6709\u5f53\u6240\u6709 promise \u90fd\u6210\u529f\u65f6\u624d\u6210\u529f\uff0c\u5426\u5219\u53ea\u8981\u6709\u4e00\u4e2a\u5931\u8d25\u5c31\u5931\u8d25\n   */\n  Promise.all = function (promises) {\n\n  }\n\n  /**\n   * Promise \u51fd\u6570\u5bf9\u8c61\u7684 race \u65b9\u6cd5\n   * @param {Array<Promise>} promises\n   * @returns \u8fd4\u56de\u4e00\u4e2a promise \u5bf9\u8c61\uff0c\u5176\u7ed3\u679c\u7531\u7b2c\u4e00\u4e2a\u5b8c\u6210\u7684 promise \u51b3\u5b9a\n   */\n  Promise.race = function (promises) {\n\n  }\n\n  // \u5411\u5916\u66b4\u9732 MyPromise \u51fd\u6570\n  window.MyPromise = Promise\n\n})(window)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"promise-\u6784\u9020\u51fd\u6570",children:"Promise \u6784\u9020\u51fd\u6570"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"/**\n * Promise \u6784\u9020\u51fd\u6570\n * @param {*} executor \u6267\u884c\u5668\u51fd\u6570\uff08\u540c\u6b65\u6267\u884c\uff09(resolve, reject) => {}\n */\nfunction Promise(executor) {\n\n  const self = this\t\t// \u4fdd\u5b58\u5f53\u524d\u5b9e\u4f8b\u5bf9\u8c61\u7684 this \u7684\u503c\n\n  // \u6dfb\u52a0\u5c5e\u6027\n  self.PromiseState = PENDING\t\t// \u7ed9 promise \u5bf9\u8c61\u6307\u5b9a status \u5c5e\u6027\uff0c\u521d\u59cb\u503c\u4e3a pending\n  self.PromiseResult = null\t\t\t// \u7ed9 promise \u5bf9\u8c61\u6307\u5b9a\u4e00\u4e2a\u7528\u4e8e\u5b58\u50a8\u7ed3\u679c\u6570\u636e\u7684\u5c5e\u6027\n  self.callbacks = []\t\t\t\t\t\t// \u5b58\u7684\u662f\u5bf9\u8c61\uff0c\u6bcf\u4e2a\u5143\u7d20\u7684\u7ed3\u6784\uff1a{ onResolved() {}, onRejected() {} }\n\n  /**\n   * executor \u5185\u90e8\u5b9a\u4e49\u6210\u529f\u65f6\u8c03\u7528\u7684\u51fd\u6570\n   * @param {*} value \u6210\u529f\u7684\u503c\n   * @returns \n   */\n  function resolve(value) {\n    // \u5982\u679c\u5f53\u524d\u72b6\u6001\u4e0d\u662f pending\uff0c\u76f4\u63a5\u7ed3\u675f\n    if (self.PromiseState !== PENDING) return\n    // 1. \u4fee\u6539\u5bf9\u8c61\u7684\u72b6\u6001\uff08promiseState\uff09\u4e3a fulfilled\n    self.PromiseState = RESOLVED \n    // 2. \u8bbe\u7f6e\u5bf9\u8c61\u7ed3\u679c\u503c\uff08promiseResult\uff09\u4e3a value\n    self.PromiseResult = value\n    // \u5982\u679c\u6709\u5f85\u6267\u884c\u7684 callback \u51fd\u6570\uff0c\u7acb\u5373\u3010\u5f02\u6b65\u3011\u6267\u884c\u56de\u8c03\u51fd\u6570 onResolved\n    if (self.callbacks.length > 0) {\n      setTimeout(() => {\t\t// \u653e\u5165\u961f\u5217\u4e2d\u6267\u884c\u6240\u6709\u6210\u529f\u7684\u56de\u8c03\n        self.callbacks.forEach(callbackObj => {\n          callbackObj.onResolved(value)\n        })\n      }, 0)\n    }\n  }\n\n  /**\n   * executor \u5185\u90e8\u5b9a\u4e49\u5931\u8d25\u65f6\u8c03\u7528\u7684\u51fd\u6570\n   * @param {*} reason \u5931\u8d25\u7684\u539f\u56e0\n   * @returns \n   */\n  function reject(reason) {\n    // \u5982\u679c\u5f53\u524d\u72b6\u6001\u4e0d\u662f pending\uff0c\u76f4\u63a5\u7ed3\u675f\n    if (self.PromiseState !== PENDING) return\n    // 1. \u4fee\u6539\u5bf9\u8c61\u7684\u72b6\u6001\uff08promiseState\uff09\u4e3a rejected\n    self.PromiseState = REJECTED\n    // 2. \u8bbe\u7f6e\u5bf9\u8c61\u7ed3\u679c\u503c\uff08promiseResult\uff09\u4e3a reason\n    self.PromiseResult = reason\n    // \u5982\u679c\u6709\u5f85\u6267\u884c\u7684 callback \u51fd\u6570\uff0c\u7acb\u5373\u3010\u5f02\u6b65\u3011\u6267\u884c\u56de\u8c03\u51fd\u6570 onRejected\n    if (self.callbacks.length > 0) {\n      setTimeout(() => {\t\t// \u653e\u5165\u961f\u5217\u4e2d\u6267\u884c\u6240\u6709\u5931\u8d25\u7684\u56de\u8c03\n        self.callbacks.forEach(callbackObj => {\n          callbackObj.onRejected(reason)\n        })\n      }, 0)\n    }\n  }\n\n  // \u7acb\u5373\u3010\u540c\u6b65\u3011\u6267\u884c executor \u51fd\u6570\n  try {\n    executor(resolve, reject)\n  } catch(error) {\t\t// \u5982\u679c\u6267\u884c\u5668\u629b\u51fa\u5f02\u5e38\uff0cpromise \u5bf9\u8c61\u53d8\u6210 rejected \u72b6\u6001\n    reject(error)\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"promiseprototypethen",children:"Promise.prototype.then"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"Promise.prototype.then = function (onResolved, onRejected) {\n  const self = this\n  // \u8fd4\u56de\u7684\u65b0\u7684 promise \u7684\u7ed3\u679c\uff0c\u53d6\u51b3\u4e8e\u56de\u8c03\u51fd\u6570 onResolved/onRejected \u7684\u8fd4\u56de\u7ed3\u679c\n  // \u8fd9\u4e24\u4e2a\u56de\u8c03\u7684\u8fd4\u56de\u7ed3\u679c\uff0c\u51b3\u5b9a\u4e86\u8fd4\u56de\u7684\u8fd9\u4e2a\u65b0 promise \u4e2d\u662f\u8c03 resolve \u8fd8\u662f reject\n  return new Promise((resolve, reject) => {\n    // \u5982\u679c\u5f53\u524d\u72b6\u6001\u8fd8\u662f pending\uff0c\u5c31\u5c06\u56de\u8c03\u51fd\u6570\u4fdd\u5b58\u8d77\u6765\n    if (self.PromiseState === PENDING) {\n      self.callbacks.push({\n        onResolved(value) {\n          // \u5c06\u56de\u8c03\u5b58\u5230 self.callbacks \u4e2d\u65f6\u4e0d\u7528 setTimeout\n          // \u56e0\u4e3a\u5f53\u8c03\u7528 self.callbacks \u4e2d\u7684\u56de\u8c03\u51fd\u6570\u65f6\uff0c\u5e94\u8be5\u662f\u5f02\u6b65\u8c03\u7528\u7684\n          try {\n            // \u6267\u884c\u6210\u529f\u7684\u56de\u8c03\uff0cresult \u63a5\u6536\u8fd4\u56de\u503c\n            const result = onResolved(self.PromiseResult)\t\t// \u8fd9\u91cc\u4e5f\u53ef\u4ee5\u4f20 value\n            if (result instanceof Promise) {\t// 3. \u5982\u679c\u56de\u8c03\u51fd\u6570\u8fd4\u56de\u7684\u662f promise\n              // \u6b63\u5e38\u5199\u6cd5\n              // result.then(\n              //   value => resolve(value)\t\t// \u5f53result\u6210\u529f\u65f6\uff0c\u8ba9return\u7684promise\u4e5f\u6210\u529f\n              //   reason => reject(reason)\t\t// \u5f53result\u5931\u8d25\u65f6\uff0c\u8ba9return\u7684promise\u4e5f\u5931\u8d25\n              // )\n              // \u7b80\u6d01\u5199\u6cd5\n              result.then(resolve, reject)\n            } else {\t\t\t\t\t\t\t\t\t\t\t\t\t// 2. \u5982\u679c\u56de\u8c03\u51fd\u6570\u8fd4\u56de\u7684\u4e0d\u662f promise\n              resolve(result)\n            }\n          } catch (error) {\t\t\t\t\t\t\t\t\t\t// 1. \u5982\u679c\u629b\u51fa\u5f02\u5e38\n            reject(error)\n          }\n        },\n        onRejected(reason) {\n          try {\n            // \u6267\u884c\u5931\u8d25\u7684\u56de\u8c03\uff0cresult \u63a5\u6536\u8fd4\u56de\u503c\n            const result = onRejected(self.PromiseResult)\t\t// \u8fd9\u91cc\u4e5f\u53ef\u4ee5\u4f20 reason\n            if (result instanceof Promise) {\t// 3. \u5982\u679c\u56de\u8c03\u51fd\u6570\u8fd4\u56de\u7684\u662f promise\n              result.then(resolve, reject)\n            } else {\t\t\t\t\t\t\t\t\t\t\t\t\t// 2. \u5982\u679c\u56de\u8c03\u51fd\u6570\u8fd4\u56de\u7684\u4e0d\u662f promise\n              resolve(result)\n            }\n          } catch (error) {\t\t\t\t\t\t\t\t\t\t// 1. \u5982\u679c\u629b\u51fa\u5f02\u5e38\n            reject(error)\n          }\n        }\n      })\n    }\n    // \u5982\u679c\u5f53\u524d\u72b6\u6001\u662f fulfilled\n    if (self.PromiseState === RESOLVED) {\n      setTimeout(() => {\n        /**\n         * 1. \u5982\u679c\u629b\u51fa\u5f02\u5e38\uff0creturn \u7684 promise \u5c31\u4f1a\u5931\u8d25\uff0creason \u662f error\n         * 2. \u5982\u679c\u56de\u8c03\u51fd\u6570\u8fd4\u56de\u7684\u4e0d\u662f promise\uff0creturn \u7684 promise \u5c31\u4f1a\u6210\u529f\uff0cvalue \u5c31\u662f\u8fd4\u56de\u7684\u503c\n         * 3. \u5982\u679c\u56de\u8c03\u51fd\u6570\u8fd4\u56de\u7684\u662f promise\uff0creturn \u7684 promise \u7ed3\u679c\u5c31\u662f\u8fd9\u4e2a promise \u7684\u7ed3\u679c\n         */\n        try {\n          const result = onResolved(self.PromiseResult) // \u6267\u884c\u6210\u529f\u7684\u56de\u8c03 result\u63a5\u6536\u8fd4\u56de\u503c\n          if (result instanceof Promise) { // 3. \u5982\u679c\u56de\u8c03\u51fd\u6570\u8fd4\u56de\u7684\u662fpromise\n            // \u6b63\u5e38\u5199\u6cd5\n            // result.then(\n            //   value => resolve(value)\t// \u5f53 result \u6210\u529f\u65f6\uff0c\u8ba9 return \u7684 promise \u4e5f\u6210\u529f\n            //   reason => reject(reason)\t// \u5f53 result \u5931\u8d25\u65f6\uff0c\u8ba9 return \u7684 promise \u4e5f\u5931\u8d25\n            // )\n            // \u7b80\u6d01\u5199\u6cd5\n            result.then(resolve, reject)\n          } else {\t\t\t\t\t\t\t\t\t\t\t\t// 2. \u5982\u679c\u56de\u8c03\u51fd\u6570\u8fd4\u56de\u7684\u4e0d\u662f promise\n            resolve(result)\n          }\n        } catch (error) {\t\t\t\t\t\t\t\t\t// 1. \u5982\u679c\u629b\u51fa\u5f02\u5e38\n          reject(error)\n        }\n      }, 0)\n    }\n    // \u5982\u679c\u5f53\u524d\u72b6\u6001\u662f rejected\n    if (self.PromiseState === REJECTED) {\n      setTimeout(() => {\n        try {\n          // \u6267\u884c\u5931\u8d25\u7684\u56de\u8c03\uff0cresult \u63a5\u6536\u8fd4\u56de\u503c\n          const result = onRejected(self.PromiseResult)\n          if (result instanceof Promise) {\t// 3. \u5982\u679c\u56de\u8c03\u51fd\u6570\u8fd4\u56de\u7684\u662f promise\n            result.then(resolve, reject)\n          } else {\t\t\t\t\t\t\t\t\t\t\t\t\t// 2. \u5982\u679c\u56de\u8c03\u51fd\u6570\u8fd4\u56de\u7684\u4e0d\u662f promise\n            resolve(result)\n          }\n        } catch (error) {\t\t\t\t\t\t\t\t\t\t// 1. \u5982\u679c\u629b\u51fa\u5f02\u5e38\n          reject(error)\n        }\n      }, 0)\n    }\n  })\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u4e0a\u9762\u7684\u201c\u7b80\u6d01\u5199\u6cd5\u201d\uff0c\u7c7b\u4f3c\u4e8e\u4ee5\u4e0b\u4ee3\u7801\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"function fn(event) {\n  // doSomething\n}\n\n// \u5b8c\u6574\u5199\u6cd5\ndiv.onclick = function (event) {\n  fn(event)\n}\n\n// \u7b80\u5316\u5199\u6cd5\ndiv.onclick = fn\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u628a ",(0,s.jsx)(n.code,{children:"then"})," \u65b9\u6cd5\u7684\u4ee3\u7801\u7b80\u5316\u5c01\u88c5\u4e00\u4e0b\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"/**\n * Promise \u539f\u578b\u5bf9\u8c61\u7684 then \u65b9\u6cd5 \n * \u6307\u5b9a\u6210\u529f\u548c\u5931\u8d25\u7684\u56de\u8c03\u51fd\u6570\n * @param {function} onResolved \u6210\u529f\u7684\u56de\u8c03\u51fd\u6570 (value) => {}\n * @param {function} onRejected \u5931\u8d25\u7684\u56de\u8c03\u51fd\u6570 (reason) => {}\n * @returns \u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 promise \u5bf9\u8c61\uff0c\u7ed3\u679c\u7531 onResolved/onRejected \u6267\u884c\u7684\u7ed3\u679c\u51b3\u5b9a\n */\nPromise.prototype.then = function (onResolved, onRejected) {\n  // \u5728\u4f7f\u7528 then \u65f6\uff0conResolved \u4e5f\u53ef\u80fd\u4e0d\u4f20\n  // \u6bd4\u5982\uff1acatch\uff08catch \u662f then \u7684\u4e00\u4e2a\u8bed\u6cd5\u7cd6\uff09\uff0ccatch \u53ea\u9700\u8981\u4f20 onRejected \u5373\u53ef\n  // \u4fdd\u9669\u8d77\u89c1\uff0c\u9700\u8981\u7ed9 onResolved \u6307\u5b9a\u4e00\u4e2a\u9ed8\u8ba4\u503c\n  // \u5bf9\u4e8e onResolved \u6765\u8bf4\uff0c\u53ea\u9700\u8981\u5c06\u6210\u529f\u7684\u503c return \u51fa\u53bb\uff0c\u5411\u540e\u4f20\u9012\u5373\u53ef\n  // \u6307\u5b9a\u9ed8\u8ba4\u7684\u6210\u529f\u7684\u56de\u8c03 onResolved\uff08\u5411\u540e\u4f20\u9012\u6210\u529f\u7684 value\uff09\n  onResolved = typeof onResolved === 'function' ? onResolved : value => value\n  // \u5728\u4f7f\u7528 then \u65f6\uff0conRejected \u51fd\u6570\u4e5f\u53ef\u4ee5\u4e0d\u4f20\n  // \u5982\u679c\u6ca1\u4f20\uff0c\u5f53 promise \u7684\u72b6\u6001\u4e3a\u5931\u8d25\u65f6\uff0c\u6216\u8005 onResolved \u629b\u51fa\u5f02\u5e38\u65f6\n  // \u5c31\u8981\u5c06\u5931\u8d25\u7684 reason \u6216\u8005\u629b\u51fa\u7684\u5f02\u5e38\u7ee7\u7eed\u5f80\u540e\u4f20\u9012\n  // \u6240\u4ee5 onRejected \u9700\u8981\u6307\u5b9a\u4e00\u4e2a\u9ed8\u8ba4\u503c\n  // \u6307\u5b9a\u9ed8\u8ba4\u7684\u5931\u8d25\u7684\u56de\u8c03 onRejected\uff08\u5411\u540e\u4f20\u9012\u5931\u8d25\u7684 reason\uff0c\u5b9e\u73b0\u9519\u8bef/\u5f02\u5e38\u4f20\u900f\u7684\u5173\u952e\u70b9\uff09\n  // \u6ce8\u610f\uff1a\u8fd9\u91cc\u662f throw reason \u800c\u4e0d\u662f return reason\n  //      \u662f\u56e0\u4e3a\u5982\u679c return reason\uff0c\u90a3\u4e48\u8fd4\u56de\u7684\u65b0\u7684 promise \u7684\u72b6\u6001\u5c31\u4f1a\u53d8\u6210\u6210\u529f\uff0c\u800c\u4e0d\u662f\u539f\u6765\u7684\u5931\u8d25\n  onRejected = typeof onRejected === 'function' ? onRejected : reason => {throw reason}\n\n  const self = this\n\n  return new Promise((resolve, reject) => {\n    /**\n     * \u8c03\u7528\u6307\u5b9a\u56de\u8c03\u51fd\u6570\u5904\u7406\uff0c\u6839\u636e\u6267\u884c\u7684\u7ed3\u679c\u6539\u53d8 return \u7684 promise \u7684\u72b6\u6001\n     * @param {function} callback \u6307\u5b9a\u56de\u8c03\u51fd\u6570\n     */\n    function handle(callback) {\n      if (typeof callback !== 'function') return\n      try {\n        // result \u83b7\u53d6\u56de\u8c03\u51fd\u6570\u6267\u884c\uff08return\uff09\u7684\u7ed3\u679c\n        const result = callback(self.PromiseResult)\n        if (result instanceof Promise) {\t// 3. \u5982\u679c\u56de\u8c03\u51fd\u6570\u8fd4\u56de\u7684\u662f promise\n          result.then(resolve, reject)\n        } else {\t\t\t\t\t\t\t\t\t\t\t\t\t// 2. \u5982\u679c\u56de\u8c03\u51fd\u6570\u8fd4\u56de\u7684\u4e0d\u662f promise\n          resolve(result)\n        }\n      } catch (error) {\t\t\t\t\t\t\t\t\t\t// 1. \u5982\u679c\u629b\u51fa\u5f02\u5e38\n        reject(error)\n      }\n    }\n\n    // 1. \u5f53\u524d\u72b6\u6001\u662f pending \u72b6\u6001\uff0c\u5c06\u56de\u8c03\u51fd\u6570\u4fdd\u5b58\u8d77\u6765\n    if (self.PromiseState === PENDING) {\n      self.callbacks.push({\n        onResolved(value) {\t\t// \u6267\u884c\u6210\u529f\u7684\u56de\u8c03\u51fd\u6570\uff0c\u6539 promise \u7684\u72b6\u6001\n          handle(onResolved)\n        },\n        onRejected(reason) {\t// \u6267\u884c\u5931\u8d25\u7684\u56de\u8c03\u51fd\u6570\uff0c\u6539 promise \u7684\u72b6\u6001\n          handle(onRejected)\n        }\n      })\n    }\n    // 2. resolved\uff0c\u3010\u5f02\u6b65\u3011\u6267\u884c onResolved\uff0c\u5e76\u6539\u53d8 return \u7684 promise \u7684\u72b6\u6001\n    if (self.PromiseState === RESOLVED) {\n      setTimeout(() => {\n        handle(onResolved)\n      }, 0)\n    }\n    // 3. rejected\uff0c\u3010\u5f02\u6b65\u3011\u6267\u884c onRejected\uff0c\u5e76\u6539\u53d8 return \u7684 promise \u7684\u72b6\u6001\n    if (self.PromiseState === REJECTED) {\n      setTimeout(() => {\n        handle(onRejected)\n      }, 0)\n    }\n  })\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"promiseprototypecatch",children:"Promise.prototype.catch"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"/**\n * Promise \u539f\u578b\u5bf9\u8c61\u7684 catch \u65b9\u6cd5\n * \u6307\u5b9a\u5931\u8d25\u7684\u56de\u8c03\u51fd\u6570\n * @param {function} onRejected \u5931\u8d25\u7684\u56de\u8c03\u51fd\u6570 (reason) => {}\n * @returns \u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 promise \u5bf9\u8c61\n */\nPromise.prototype.catch = function (onRejected) {\n  return this.then(undefined, onRejected)\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"promiseresolve",children:"Promise.resolve"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"/**\n * Promise \u51fd\u6570\u5bf9\u8c61\u7684 resolve \u65b9\u6cd5\n * @param {*} value \u6210\u529f\u7684\u503c\n * @returns \u8fd4\u56de\u4e00\u4e2a\u6210\u529f/\u5931\u8d25\u7684 promise\n */\nPromise.resolve = function (value) {\n  // \u8fd4\u56de\u4e00\u4e2a\u6210\u529f/\u5931\u8d25\u7684 promise\n  return new Promise((resolve, reject) => {\n    if (value instanceof Promise) {\t// value \u662f promise\uff1a\u4f7f\u7528 value \u7684\u7ed3\u679c\u4f5c\u4e3a promise \u7684\u7ed3\u679c\n      value.then(resolve, reject)\n    } else {\t\t// value \u4e0d\u662f promise\uff1apromise \u72b6\u6001\u53d8\u4e3a\u6210\u529f\uff0c\u6570\u636e\u662f value\n      resolve(value)\n    }\n  })\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"promisereject",children:"Promise.reject"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"/**\n * Promise \u51fd\u6570\u5bf9\u8c61\u7684 reject \u65b9\u6cd5\n * @param {*} resaon \u5931\u8d25\u7684\u539f\u56e0\n * @returns \u8fd4\u56de\u4e00\u4e2a\u5931\u8d25\u7684 promise\n */\nPromise.reject = function (reason) {\n  return new Promise((resolve, reject) => {\n    reject(reason)\n  })\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"promiseall",children:"Promise.all"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"/**\n * Promise \u51fd\u6570\u5bf9\u8c61\u7684 all \u65b9\u6cd5\n * @param {Array<Promise>} promises\n * @returns \u8fd4\u56de\u4e00\u4e2a promise\uff0c\u53ea\u6709\u5f53\u6240\u6709 promise \u90fd\u6210\u529f\u65f6\u624d\u6210\u529f\uff0c\u5426\u5219\u53ea\u8981\u6709\u4e00\u4e2a\u5931\u8d25\u5c31\u5931\u8d25\n */\nPromise.all = function (promises) {\n  return new Promise((resolve, reject) => {\n    let count = 0 // \u58f0\u660e\u8ba1\u6570\u53d8\u91cf\n    // const values = []; // \u4fdd\u5b58\u6bcf\u4e2a\u6210\u529f\u7684 promise \u7ed3\u679c\u7684\u6570\u7ec4\n    const values = new Array(promises.length) // \u6307\u5b9a\u6570\u7ec4\u957f\u5ea6\n    for (let i = 0; i < promises.length; i ++){\n      // promises[i].then(value => {\n      // \u4e3a\u4e86\u9632\u6b62\u6570\u7ec4\u4e2d\u6709\u4e0d\u662f promise \u7684\u5143\u7d20\uff0c\u53ef\u4ee5\u5c06\u6bcf\u4e2a\u5143\u7d20\u653e\u5230 Promise.resolve \u4e2d\n      Promise.resolve(promises[i]).then(value => {\n        // \u5f97\u77e5\u5bf9\u8c61\u72b6\u6001\u662f\u6210\u529f\n        count ++\n        // \u5c06\u5f53\u524d promise \u5bf9\u8c61\u6210\u529f\u7684\u7ed3\u679c\u5b58\u5165\u5230\u6570\u7ec4\u4e2d\n        values[i] = value\n        if (count === promises.length) {\t\t// \u6bcf\u4e2a promise \u5bf9\u8c61\u90fd\u6210\u529f\n          resolve(values) // \u4fee\u6539\u8fd4\u56de\u7684 promise \u72b6\u6001\n        }\n      }, reason => {\n        reject(reason)\n      })\n    }\n  })\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"promiserace",children:"Promise.race"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"/**\n * Promise \u51fd\u6570\u5bf9\u8c61\u7684 race \u65b9\u6cd5\n * @param {Array<Promise>} promises \n * @returns \u8fd4\u56de\u4e00\u4e2a promise\uff0c\u5176\u7ed3\u679c\u7531\u7b2c\u4e00\u4e2a\u5b8c\u6210\u7684 promise \u51b3\u5b9a\n */\nPromise.race = function (promises) {\n  return new Promise((resolve, reject) => {\n    for (let i = 0; i < promises.length; i ++){\n      // promises[i].then(value => {\n      // \u4e3a\u4e86\u9632\u6b62\u6570\u7ec4\u4e2d\u6709\u4e0d\u662f promise \u7684\u5143\u7d20\uff0c\u53ef\u4ee5\u5c06\u6bcf\u4e2a\u5143\u7d20\u653e\u5230 Promise.resolve \u4e2d\n      Promise.resolve(promises[i]).then(value => {\n        // \u4fee\u6539\u8fd4\u56de\u7684 promise \u5bf9\u8c61\u7684\u72b6\u6001\u4e3a\u6210\u529f\n        resolve(value)\n      }, reason => {\n        reject(reason)\n      })\n    }\n  })\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u81ea\u5b9a\u4e49\u51fd\u6570\u5bf9\u8c61\u65b9\u6cd5promiseresolvedelaypromiserejectdelay",children:"\u81ea\u5b9a\u4e49\u51fd\u6570\u5bf9\u8c61\u65b9\u6cd5\uff1aPromise.resolveDelay&Promise.rejectDelay"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"/**\n * \u81ea\u5b9a\u4e49\u65b9\u6cd5 \u5ef6\u65f6\u8fd4\u56de\u4e00\u4e2a\u6210\u529f/\u5931\u8d25\u7684 promise\n * @param {*} value \u6210\u529f\u7684\u6570\u636e\n * @param {Number} timeout \u5ef6\u8fdf\u65f6\u95f4\n * @returns \u4e00\u4e2a\u6210\u529f/\u5931\u8d25\u7684 promise\n */\nPromise.resolveDelay = function (value, timeout) {\n  // \u5ef6\u65f6\u8fd4\u56de\u4e00\u4e2a\u6210\u529f/\u5931\u8d25\u7684 promise\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      if (value instanceof Promise) {\n        // value \u662f promise\uff0c\u4f7f\u7528 value \u7684\u7ed3\u679c\u4f5c\u4e3a promise \u7684\u7ed3\u679c\n        value.then(resolve,reject)\n      } else {\n        // value \u4e0d\u662f promise\uff0cpromise \u72b6\u6001\u53d8\u4e3a\u6210\u529f\uff0c\u6570\u636e\u662f value\n        resolve(value)\n      }\n    })\n  }, timeout)\n}\n\n/**\n * \u81ea\u5b9a\u4e49\u65b9\u6cd5 \u5ef6\u65f6\u8fd4\u56de\u4e00\u4e2a\u5931\u8d25\u7684 promise\n * @param {*} reason \u5931\u8d25\u7684\u539f\u56e0\n * @param {*} timeout \u5ef6\u8fdf\u65f6\u95f4\n * @returns \u4e00\u4e2a\u5931\u8d25\u7684 promise\n */\nPromise.rejectDelay = function (reason, timeout) {\n  // \u5ef6\u65f6\u8fd4\u56de\u4e00\u4e2a\u5931\u8d25\u7684 promise\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      reject(reason)\n    }, timeout)\n  })\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"class-\u5199\u6cd5",children:"class \u5199\u6cd5"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"/**\n * \u81ea\u5b9a\u4e49Promise\u51fd\u6570\u6a21\u5757\uff1aIIFE\n */\n(function (window) {\n\n  const PENDING = 'pending'\n  const RESOLVED = 'fulfilled'\n  const REJECTED = 'rejected'\n\n  class Promise {\n    /**\n     * Promise\u6784\u9020\u51fd\u6570\n     * @param {function} executor \u6267\u884c\u5668\u51fd\u6570\uff08\u540c\u6b65\u6267\u884c\uff09(resolve, reject) => {}\n     */\n    constructor(executor) {\n\n      const self = this; // \u4fdd\u5b58\u5f53\u524d\u5b9e\u4f8b\u5bf9\u8c61\u7684this\u7684\u503c\n      // \u6dfb\u52a0\u5c5e\u6027\n      self.PromiseState = PENDING // \u7ed9promise\u5bf9\u8c61\u6307\u5b9astatus\u5c5e\u6027\uff0c\u521d\u59cb\u503c\u4e3apending\n      self.PromiseResult = null // \u7ed9promise\u5bf9\u8c61\u6307\u5b9a\u4e00\u4e2a\u7528\u4e8e\u5b58\u50a8\u7ed3\u679c\u6570\u636e\u7684\u5c5e\u6027\n      self.callbacks = [] // \u5b58\u7684\u662f\u5bf9\u8c61 \u6bcf\u4e2a\u5143\u7d20\u7684\u7ed3\u6784\uff1a{onResolved() {}, onRejected() {}}\n\n      /**\n       * executor\u5185\u90e8\u5b9a\u4e49\u6210\u529f\u65f6\u8c03\u7528\u7684\u51fd\u6570\n       * @param {*} value \u6210\u529f\u7684\u503c\n       * @returns \n       */\n      function resolve(value) {\n        // \u5982\u679c\u5f53\u524d\u72b6\u6001\u4e0d\u662fpending\uff0c\u76f4\u63a5\u7ed3\u675f\n        if (self.PromiseState !== PENDING) return\n        // 1. \u4fee\u6539\u5bf9\u8c61\u7684\u72b6\u6001\uff08promiseState\uff09\u4e3a fulfilled\n        self.PromiseState = RESOLVED\n        // 2. \u8bbe\u7f6e\u5bf9\u8c61\u7ed3\u679c\u503c\uff08promiseResult\uff09\u4e3a value\n        self.PromiseResult = value\n        // \u5982\u679c\u6709\u5f85\u6267\u884c\u7684callback\u51fd\u6570\uff0c\u7acb\u5373\u3010\u5f02\u6b65\u3011\u6267\u884c\u56de\u8c03\u51fd\u6570onResolved\n        if (self.callbacks.length > 0) {\n          setTimeout(() => { // \u653e\u5165\u961f\u5217\u4e2d\u6267\u884c\u6240\u6709\u6210\u529f\u7684\u56de\u8c03\n            self.callbacks.forEach(callbacksObj => {\n              callbacksObj.onResolved(value)\n            })\n          }, 0)\n        }\n      }\n\n      /**\n       * executor\u5185\u90e8\u5b9a\u4e49\u5931\u8d25\u65f6\u8c03\u7528\u7684\u51fd\u6570\n       * @param {*} reason \u5931\u8d25\u7684\u539f\u56e0\n       * @returns \n       */\n      function reject(reason) {\n        // \u5982\u679c\u5f53\u524d\u72b6\u6001\u4e0d\u662fpending\uff0c\u76f4\u63a5\u7ed3\u675f\n        if (self.PromiseState !== PENDING) return\n        // 1. \u4fee\u6539\u5bf9\u8c61\u7684\u72b6\u6001\uff08promiseState\uff09\u4e3a rejected\n        self.PromiseState = REJECTED\n        // 2. \u8bbe\u7f6e\u5bf9\u8c61\u7ed3\u679c\u503c\uff08promiseResult\uff09\u4e3a reason\n        self.PromiseResult = reason\n        // \u5982\u679c\u6709\u5f85\u6267\u884c\u7684callback\u51fd\u6570\uff0c\u7acb\u5373\u3010\u5f02\u6b65\u3011\u6267\u884c\u56de\u8c03\u51fd\u6570onRejected\n        if (self.callbacks.length > 0) {\n          setTimeout(() => { // \u653e\u5165\u961f\u5217\u4e2d\u6267\u884c\u6240\u6709\u5931\u8d25\u7684\u56de\u8c03\n            self.callbacks.forEach(callbacksObj => {\n              callbacksObj.onRejected(reason)\n            })\n          }, 0)\n        }\n      }\n\n      // \u7acb\u5373\u3010\u540c\u6b65\u3011\u6267\u884cexecutor\u51fd\u6570\n      try {\n        executor(resolve, reject)\n      } catch (error) { // \u5982\u679c\u6267\u884c\u5668\u629b\u51fa\u5f02\u5e38\uff0cpromise\u5bf9\u8c61\u53d8\u6210rejected\u72b6\u6001\n        reject(error)\n      }\n    }\n\n    /**\n     * Promise\u539f\u578b\u5bf9\u8c61then\u65b9\u6cd5 \n     * \u6307\u5b9a\u6210\u529f\u548c\u5931\u8d25\u7684\u56de\u8c03\u51fd\u6570\n     * @param {function} onResolved \u6210\u529f\u7684\u56de\u8c03\u51fd\u6570(value) => {}\n     * @param {function} onRejected \u5931\u8d25\u7684\u56de\u8c03\u51fd\u6570(reason) => {}\n     * @returns \u4e00\u4e2a\u65b0\u7684promise\u5bf9\u8c61\u7ed3\u679c\u7531onResolved/onRejected\u6267\u884c\u7684\u7ed3\u679c\u51b3\u5b9a\n     */\n    then (onResolved, onRejected) {\n      // \u6307\u5b9a\u9ed8\u8ba4\u7684\u6210\u529f\u7684\u56de\u8c03onResolved \uff08\u5411\u540e\u4f20\u9012\u6210\u529f\u7684value\uff09\n      onResolved = typeof onResolved === 'function' ? onResolved : value => value\n      // \u6307\u5b9a\u9ed8\u8ba4\u7684\u5931\u8d25\u7684\u56de\u8c03onRejected\uff08\u5411\u540e\u4f20\u9012\u5931\u8d25\u7684reason \u5b9e\u73b0\u9519\u8bef/\u5f02\u5e38\u4f20\u900f\u7684\u5173\u952e\u70b9\uff09\n      onRejected = typeof onRejected === 'function' ? onRejected : reason => {throw reason}\n\n      const self = this\n\n      return new Promise((resolve, reject) => {\n        /**\n         * \u8c03\u7528\u6307\u5b9a\u56de\u8c03\u51fd\u6570\u5904\u7406\uff0c\u6839\u636e\u6267\u884c\u7684\u7ed3\u679c\u6539\u53d8return\u7684promise\u7684\u72b6\u6001\n         * @param {function} callback \u6307\u5b9a\u56de\u8c03\u51fd\u6570\n         */\n        function handle(callback) {\n          try {\n            const result = callback(self.PromiseResult) // result\u83b7\u53d6\u56de\u8c03\u51fd\u6570\u6267\u884c(return)\u7684\u7ed3\u679c\n            if (result instanceof Promise) { // 3. \u5982\u679c\u56de\u8c03\u51fd\u6570\u8fd4\u56de\u7684\u662fpromise\n              result.then(resolve, reject) // \u7b80\u6d01\u5199\u6cd5\n            } else { // 2. \u5982\u679c\u56de\u8c03\u51fd\u6570\u8fd4\u56de\u7684\u4e0d\u662fpromise\n              resolve(result)\n            }\n          } catch (error) { //1. \u5982\u679c\u629b\u51fa\u5f02\u5e38\n            reject(error)\n          }\n        }\n\n        if (self.PromiseState === PENDING) { // 1. \u5f53\u524d\u72b6\u6001\u662fpending\u72b6\u6001\uff0c\u5c06\u56de\u8c03\u51fd\u6570\u4fdd\u5b58\u8d77\u6765\n          self.callbacks.push({\n            onResolved(value) { //\u6267\u884c\u6210\u529f\u7684\u56de\u8c03\u51fd\u6570\uff0c\u6539promise\u7684\u72b6\u6001\n              handle(onResolved)\n            },\n            onRejected(reason) { //\u6267\u884c\u5931\u8d25\u7684\u56de\u8c03\u51fd\u6570\uff0c\u6539promise\u7684\u72b6\u6001\n              handle(onRejected)\n            }\n          })\n        } else if (self.PromiseState === RESOLVED) { // 2. resolved\uff0c\u3010\u5f02\u6b65\u3011\u6267\u884conResolved\u5e76\u6539\u53d8return\u7684promise\u7684\u72b6\u6001\n          setTimeout(() => {\n            handle(onResolved)\n          }, 0)\n        } else { // 3. rejected\uff0c\u3010\u5f02\u6b65\u3011\u6267\u884conRejected\u5e76\u6539\u53d8return\u7684promise\u7684\u72b6\u6001\n          setTimeout(() => {\n            handle(onRejected)\n          }, 0)\n        }\n      })\n    }\n\n\n    /**\n     * Promise\u539f\u578b\u5bf9\u8c61catch\u65b9\u6cd5\n     * \u6307\u5b9a\u5931\u8d25\u7684\u56de\u8c03\u51fd\u6570\n     * @param {function} onRejected \u5931\u8d25\u7684\u56de\u8c03\u51fd\u6570(reason) => {}\n     * @returns \u4e00\u4e2a\u65b0\u7684promise\u5bf9\u8c61\n     */\n    catch (onRejected) {\n      return this.then(undefined, onRejected)\n    }\n\n\n    /**\n     * Promise\u51fd\u6570\u5bf9\u8c61resolve\u65b9\u6cd5\n     * @param {*} value \u6210\u529f\u7684\u503c\n     * @returns \u4e00\u4e2a\u6210\u529f/\u5931\u8d25\u7684promise\n     */\n    static resolve(value) {\n      // \u8fd4\u56de\u4e00\u4e2a\u6210\u529f/\u5931\u8d25\u7684promise\n      return new Promise((resolve, reject) => {\n        if (value instanceof Promise) { // value\u662fpromise => \u4f7f\u7528value\u7684\u7ed3\u679c\u4f5c\u4e3apromise\u7684\u7ed3\u679c\n          value.then(resolve,reject)\n        } else { // value\u4e0d\u662fpromise => promise\u72b6\u6001\u53d8\u4e3a\u6210\u529f\uff0c\u6570\u636e\u662fvalue\n          resolve(value)\n        }\n      })\n    }\n\n\n    /**\n     * Promise\u51fd\u6570\u5bf9\u8c61reject\u65b9\u6cd5\n     * @param {*} resaon \u5931\u8d25\u7684\u539f\u56e0\n     * @returns \u4e00\u4e2a\u5931\u8d25\u7684promise\n     */\n    static reject (reason) {\n      // \u8fd4\u56de\u4e00\u4e2a\u5931\u8d25\u7684promise\n      return new Promise((resolve, reject) => {\n        reject(reason)\n      })\n    }\n\n\n    /**\n     * Promise\u51fd\u6570\u5bf9\u8c61all\u65b9\u6cd5\n     * @param {Array<Promise>} promises \n     * @returns \u4e00\u4e2apromise\uff0c\u53ea\u6709\u5f53\u6240\u6709promise\u90fd\u6210\u529f\u65f6\u624d\u6210\u529f\uff0c\u5426\u5219\u53ea\u8981\u6709\u4e00\u4e2a\u5931\u8d25\u5c31\u5931\u8d25\n     */\n    static all (promises) {\n      return new Promise((resolve, reject) => {\n        let count = 0 // \u58f0\u660e\u8ba1\u6570\u53d8\u91cf\n        // const values = []; // \u4fdd\u5b58\u6bcf\u4e2a\u6210\u529fpromise\u7ed3\u679c\u7684\u6570\u7ec4\n        const values = new Array(promises.length) // \u6307\u5b9a\u6570\u7ec4\u957f\u5ea6\n        for (let i = 0; i < promises.length; i++){\n          // promises[i].then(value => {\n          Promise.resolve(promises[i]).then(value => { // \u9632\u6b62\u6570\u7ec4\u4e2d\u6709\u4e0d\u662fpromise\u7684\u5143\u7d20\n            // \u5f97\u77e5\u5bf9\u8c61\u72b6\u6001\u662f\u6210\u529f\n            count++\n            // \u5c06\u5f53\u524dpromise\u5bf9\u8c61\u6210\u529f\u7684\u7ed3\u679c\u5b58\u5165\u5230\u6570\u7ec4\u4e2d\n            values[i] = value\n            if (count === promises.length) { //\u6bcf\u4e2apromise\u5bf9\u8c61\u90fd\u6210\u529f\n              resolve(values) // \u4fee\u6539\u51fd\u6570\u72b6\u6001\n            }\n          }, reason => {\n            reject(reason)\n          })\n        }\n      })\n    }\n\n\n    /**\n     *Promise\u51fd\u6570\u5bf9\u8c61race\u65b9\u6cd5\n    * @param {Array<Promise>} promises \n    * @returns \u8fd4\u56de \u4e00\u4e2apromise\uff0c\u5176\u7ed3\u679c\u7531\u7b2c\u4e00\u4e2a\u5b8c\u6210\u7684promise\u51b3\u5b9a\n    */\n    static race (promises) {\n      return new Promise((resolve, reject) => {\n        for (let i = 0; i < promises.length; i++){\n          // promises[i].then(value => {\n          Promise.resolve(promises[i]).then(value => { // \u9632\u6b62\u6570\u7ec4\u4e2d\u6709\u4e0d\u662fpromise\u7684\u5143\u7d20\n            // \u4fee\u6539\u8fd4\u56de\u5bf9\u8c61\u7684\u72b6\u6001\u4e3a \u6210\u529f\n            resolve(value)\n          }, reason => {\n            reject(reason)\n          })\n        }\n      })\n    }\n\n    /**\n     * \u81ea\u5b9a\u4e49\u65b9\u6cd5 \u5ef6\u65f6\u8fd4\u56de\u4e00\u4e2a\u6210\u529f/\u5931\u8d25\u7684promise\n     * @param {*} value \u6210\u529f\u7684\u6570\u636e\n     * @param {Number} timeout \u5ef6\u8fdf\u65f6\u95f4\n     * @returns \u4e00\u4e2a\u6210\u529f/\u5931\u8d25\u7684promise\n     */\n    static resolveDelay (value, timeout) {\n      // \u5ef6\u65f6\u8fd4\u56de\u4e00\u4e2a\u6210\u529f/\u5931\u8d25\u7684promise\n      return new Promise((resolve, reject) => {\n        setTimeout(() => {\n          if (value instanceof Promise) { // value\u662fpromise => \u4f7f\u7528value\u7684\u7ed3\u679c\u4f5c\u4e3apromise\u7684\u7ed3\u679c\n            value.then(resolve,reject)\n          } else { // value\u4e0d\u662fpromise => promise\u72b6\u6001\u53d8\u4e3a\u6210\u529f\uff0c\u6570\u636e\u662fvalue\n            resolve(value)\n          }\n        })\n      }, timeout);\n    }\n\n    /**\n     * \u81ea\u5b9a\u4e49\u65b9\u6cd5 \u5ef6\u65f6\u8fd4\u56de\u4e00\u4e2a\u5931\u8d25\u7684promise\n     * @param {*} reason \u5931\u8d25\u7684\u539f\u56e0\n     * @param {*} timeout \u5ef6\u8fdf\u65f6\u95f4\n     * @returns \u4e00\u4e2a\u5931\u8d25\u7684promise\n     */\n    static rejectDelay (reason, timeout) {\n      // \u5ef6\u65f6\u8fd4\u56de\u4e00\u4e2a\u5931\u8d25\u7684promise\n      return new Promise((resolve, reject) => {\n        setTimeout(() => {\n          reject(reason)\n        }, timeout)\n      })\n    }\n  }\n\n  // \u5411\u5916\u66b4\u9732Promise\u51fd\u6570\n  window.Promise = Promise\n})(window)\n"})})]})}function u(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(m,{...e})}):m(e)}},1151:(e,n,r)=>{r.d(n,{Z:()=>l,a:()=>i});var s=r(7294);const o={},t=s.createContext(o);function i(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);