---
sidebar_position: 28
---

## 路由基本使用

```shell title="安装"
npm install vue-router@4

# OR
yarn add vue-router@4
```

```js title="src/router/index.js"
import { createRouter, createWebHashHistory } from 'vue-router'
import Home from '../views/Home.vue'
import About from '../views/About.vue'
import NotFound from '../views/NotFound.vue'
import NowPlaying from '../views/NowPlaying.vue'
import ComingSoon from '../views/ComingSoon.vue'

const routes = [
  {
    path: '/home',
    name: 'home',     // 命名路由
    alias: '/shouye', // 路由别名
    component: Home
  },
  {
    path: '/about',
    name: 'about',
    component: About,
    // 嵌套路由
    children: [
      { path: '/about/nowplaying', component: NowPlaying },
      { path: '/about/comingsoon', component: ComingSoon },
    ]
  },
  // 路由重定向（两种写法）
  {
    path: '/',
    // redirect: '/home'
    redirect: {
      name: 'home'
    }
  },
  // 404
  { path: '/:pathMatch(.*)*', name: 'NotFound', component: NotFound },
]

const router = createRouter({
  history: createWebHashHistory(),
  routes,
})

export default router
```

```js title="main.js"
import { createApp } from 'vue'
import router from './router'
import App from './App.vue'

createApp(App).use(router).mount('#app')
```

```html title="App.vue"
<template>
  <div>
    <!-- 插槽-路由容器 -->
    <router-view></router-view>
  </div>
</template>
```

## 声明式导航

```html
<template>
  <div>
    <ul>
      <li><router-link to="/home" active-class="xxx">首页</router-link></li>
      <li><router-link to="/about" active-class="xxx">关于</router-link></li>
    </ul>
    <router-view></router-view>
  </div>
</template>
```

给 `<router-link>` 添加 `custom` 属性，将 `<router-link>` 定制为其他标签。

```html title="将 router-link 定制为 li 标签"
<template>
  <div>
    <ul>
      <router-link custom to="/home" v-slot="{ isActive, navigate }">
        <li :class="isActive ? 'active' : ''" @click="navigate">首页</li>
      </router-link>
    </ul>
    <router-view></router-view>
  </div>
</template>
```

## 嵌套路由

```js title="src/router/index.js"
import { createRouter, createWebHashHistory } from 'vue-router'
import About from '../views/About.vue'
import NowPlaying from '../views/NowPlaying.vue'
import ComingSoon from '../views/ComingSoon.vue'

const routes = [
  {
    path: '/about',
    name: 'about',
    component: About,
    // 嵌套路由
    children: [
      { path: '/about/nowplaying', component: NowPlaying },
      
      // { path: '/about/comingsoon', component: ComingSoon },
      // 简写形式（注意，不能在子路由前面加 /，否则会从根路由开始匹配）
      { path: 'comingsoon', component: ComingSoon },
      
      // 重定向到二级路由（如果没有重定向，就仍然显示 About 组件，不显示其子组件）
      // 如果要重定向到二级路由，那么一级路由的重定向要使用路径的形式
      { path: '/about', redirect: '/about/nowplaying' },
    ]
  }
]

const router = createRouter({
  history: createWebHashHistory(),
  routes,
})

export default router
```

```html title="About.vue"
<template>
  <div>关于页面</div>
  
  <ul>
    <router-link custom to="/about/nowplaying" v-slot="{ isActive, navigate }">
      <li :class="isActive ? 'active' : ''" @click="navigate">正在热映</li>
    </router-link>
    <router-link custom to="/about/comingsoon" v-slot="{ isActive, navigate }">
      <li :class="isActive ? 'active' : ''" @click="navigate">即将上映</li>
    </router-link>
  </ul>
  
  <!-- <router-view> 相当于一个插槽，如果路径是 /about，<router-view> 对应的组件不会显示-->
  <router-view></router-view>
</template>
```

## 编程式导航

```js
import { useRouter } from 'vue-router'

const router = useRouter()

// 字符串路径
router.push('/users/eduardo')

// 带有路径的对象
router.push({ path: '/users/eduardo' })

// 命名的路由，并携带 params 参数
router.push({ name: 'user', params: { username: 'eduardo' } })

// 携带 query 参数
router.push({ path: '/register', query: { plan: 'private' } })

router.forward()
router.back()
router.go(2)
```

## 路由传参

### 定义参数

```js title="src/router/index.js"
import { createRouter, createWebHashHistory } from 'vue-router'
import Detail from '../views/Detail.vue'
import News from '../views/News.vue'

const routes = [
  {
    // 传递 params 参数
    path: '/detail/:id/:name',
    name: 'detail',
    component: Detail,
  },
  {
    // 传递 query 参数
    path: '/news',
    name: 'news',
    component: News,
  }
]

const router = createRouter({
  history: createWebHashHistory(),
  routes,
})

export default router
```

### 传递参数

```js title="路由跳转时携带 params 参数"
import { useRouter } from 'vue-router'
const { router } = useRouter()

// 字符串形式
router.push(`/detail/${id}/${name}`)

// 对象形式
router.push({
  name: 'detail',
  params: { id, name }
})
```

```js title="路由跳转时携带 query 参数"
import { useRouter } from 'vue-router'
const { router } = useRouter()

// 字符串形式
router.push(`/news?id=${id}&name=${name}`)

// 对象形式
router.push({
  path: '/news',
  query: { id, name }
})
```

### 获取参数

```js
import { useRoute } from 'vue-router'
const route = useRoute()

onMounted() {
  console.log(route.params, route.query)
}
```

## 路由模式

```js title="src/router/index.js"
import { createRouter, createWebHashHistory, createWebHistory } from 'vue-router'

const router = createRouter({
  // history: createWebHashHistory(), // hash 模式
  history: createWebHistory(),  // history 模式
  routes,
})

export default router
```

注意，history 模式的路径会被发送给服务器，如果服务器没有配置相应的路径，可能就会导致 404。要解决这个问题，后端可以返回一个缺省值，比如 index.html。

## 路由守卫

### 全局路由守卫

```js title="全局前置路由守卫"
router.beforeEach((to, from, next) => {
  if (to.name !== 'Login' && !isAuthenticated) next({ name: 'Login' })
  else next()
})
```

```js title="全局后置路由守卫"
router.afterEach((to, from) => {
  
})
```

全局后置路由守卫主要用于分析用户行为、更改页面标题等。

### 组件内守卫

```js title="选项式 API"
beforeRouteEnter(to, from, next) {
  
},
beforeRouteUpdate(to, from, next) {
  // 当前路由跳转到当前路由时调用
},
beforeRouteLeave(to, from, next) {

}
```

```js title="组合式 API"
import { onBeforeRouteUpdate, onBeforeRouteLeave } from 'vue-router'

// 组合式 API 没有 onBeforeRouteEnter 钩子
// onBeforeRouteEnter(() => {
//  
// })
onBeforeRouteUpdate(() => {
  
})
onBeforeRouteLeave(() => {
  
})
```

## 路由懒加载

```js
import { createRouter } from 'vue-router'
const User = () => import('./views/User.vue')

const router = createRouter({
  // ...
  routes: [
    { path: '/user', component: User },
    // OR
    { path: '/center', component: () => import('./views/Center.vue') },
  ]
})
```
