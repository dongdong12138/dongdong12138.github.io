---
sidebar_position: 6
---

# 路由

## 基本使用

Vue3 中要使用 [Vue Router](https://router.vuejs.org/zh/) 的最新版本，目前是 `4` 版本。

```ts title="router/index.ts"
import { createRouter, createWebHistory } from 'vue-router'
import Home from '@/pages/Home.vue'
import About from '@/pages/About.vue'

const router = createRouter({
  history: createWebHistory(),
  routes: [
    { path: '/home', component: Home },
    { path: '/about', component: About }
  ]
})

export default router
```

```ts title="main.ts"
import router from './router/index'

app.use(router)

app.mount('#app')
```

```html title="App.vue"
<template>
  <!-- 导航区 -->
  <div class="navigate">
    <RouterLink to="/home" active-class="active">首页</RouterLink>
    <RouterLink to="/about" active-class="active">关于</RouterLink>
  </div>
  <!-- 展示区 -->
  <div class="main-content">
    <RouterView></RouterView>
  </div>
</template>

<script setup lang="ts" name="App">
  import { RouterLink, RouterView } from 'vue-router'
</script>
```

## 两个注意点

1. 路由组件通常存放在 `pages` 或 `views` 文件夹，一般组件通常存放在 `components` 文件夹
2. 通过点击导航，视觉效果上“消失”了的路由组件，默认是被**卸载**掉的，需要的时候再去**挂载**

## 路由器工作模式

1. `history` 模式

    优点：URL 更加美观，不带有 `#`，更接近传统的网站 URL。

    缺点：后期项目上线，需要服务端配合处理路径问题，否则刷新会有 `404` 错误。

    ```ts
    import { createRouter, createWebHistory } from 'vue-router'
   
    const router = createRouter({
      history: createWebHistory(),  // history 模式
      // ...
    })
    ```

2. `hash` 模式

    优点：兼容性更好，因为不需要服务器端处理路径。

    缺点：URL 带有 `#` 不太美观，且在 SEO 优化方面相对较差。

    ```ts
    import { createRouter, createWebHashHistory } from 'vue-router'
   
    const router = createRouter({
      history: createWebHashHistory(),  // hash 模式
      // ...
    })
    ```

## to 的两种写法

```html
<!-- 第一种：to 的字符串写法 -->
<router-link active-class="active" to="/home">主页</router-link>

<!-- 第二种：to 的对象写法 -->
<router-link active-class="active" :to="{ path: '/home' }">Home</router-link>
```

## 命名路由

作用：可以简化路由跳转及传参。

```js title="路由命名"
routes:[
  { name: 'home', path: '/home', component: Home },
  { name: 'news', path: '/news', component: News, },
  { name: 'about', path: '/about', component: About }
]
```

```html title="跳转路由"
<!-- 简化前：需要写完整的路径（to 的字符串写法） -->
<router-link to="/news">新闻</router-link>

<!-- 简化后：直接通过名字跳转（to 的对象写法配合 name 属性） -->
<router-link :to="{ name: 'news' }">新闻</router-link>
```

## 嵌套路由

```ts title="router/index.ts"
const router = createRouter({
   history: createWebHistory(),
   routes: [
      { name: 'home', path: '/home', component: Home },
      {
         name: 'news', path: '/news', component: News,
         // 使用 children 配置子路由
         children: [
            // 子级路由的路径前面不用写 /
            { name: 'detail', path: 'detail', component: Detail }
         ]
      },
      { name: 'about', path: '/about', component: About }
   ]
})

export default router
```

```html title="跳转路由（要使用完整路径）"
<template>
   <nav class="news-list">
      <router-link v-for="news in newsList" :key="news.id" :to="{ path: '/news/detail' }">
         {{ news.name }}
      </router-link>
   </nav>
   <div class="news-detail">
      <router-view />
   </div>
</template>
```

## 路由传参

### query 参数

```html title="传递 query 参数"
<!-- to 的字符串写法 -->
<router-link to="/news/detail?a=1&b=2&content=欢迎你">跳转</router-link>

<!-- to 的对象写法 -->
<router-link
  :to="{
    // name: 'detail',  // 用 name 也可以跳转
    path: '/news/detail',
    query: {
      id: news.id,
      title: news.title,
      content: news.content
    }
  }"
>
  {{ news.title }}
</router-link>
```

```js title="接收 query 参数"
import { useRoute } from 'vue-router'

const route = useRoute()
console.log(route.query)
```

### params 参数

```html title="传递 params 参数"
<!-- to 的字符串写法 -->
<router-link :to="`/news/detail/001/新闻001/内容001`">{{ news.title }}</router-link>

<!-- to 的对象写法 -->
<router-link
  :to="{
    name: 'detail', // 用 name 跳转
    params: {
      id: news.id,
      title: news.title,
      content: news.title
    }
  }"
>
   {{ news.title }}
</router-link>
```

```ts title="需要在路由中占位"
{
  name: 'detail',
  path: 'detail/:id/:title/:content?',  // ? 表示该参数可选
  component: Detail,
}
```

```js title="接收 params 参数"
import { useRoute } from 'vue-router'

const route = useRoute()
console.log(route.params)
```

:::tip

- 传递 `params` 参数时，若使用 `to` 的对象写法，必须使用 `name` 配置项，不能用 `path`
- 传递 `params` 参数时，需要提前在路由规则中占位

:::

## 路由的 props 配置

作用：让路由组件更方便地接收到参数（可以将路由参数作为 `props` 传给组件）。

```js
{
	name: 'detail',
	path: 'detail/:id/:title/:content',
	component: Detail,

  // props 的对象写法，作用：把对象中的 key-value 作为 props 传给 Detail 组件
  // props: { a: 1, b: 2, c: 3 }, 

  // props 的布尔值写法，作用：把收到的 params 参数，作为 props 传给 Detail 组件
  // props: true
  
  // props 的函数写法，作用：把返回的对象中的每一组 key-value 作为 props 传给 Detail 组件
  props(route) {    // 默认接收路由信息作为参数
    return route.query
  }
}
```

## replace 属性

作用：控制路由跳转时操作浏览器历史记录的模式。

浏览器的历史记录有两种写入方式：分别为 `push` 和 `replace`。`push` 是追加历史记录（默认值），`replace` 是替换当前记录。

```html title="开启 replace 模式"
<RouterLink replace to="/news">News</RouterLink>
```

## 编程式导航

路由组件的两个重要属性 `$route` 和 `$router` 变成了两个 `hook`。

```js
import { useRoute, useRouter } from 'vue-router'

const route = useRoute()
const router = useRouter()

console.log(route.query)
console.log(route.parmas)

console.log(router.push)
console.log(router.replace)

router.push('/news')
router.push({
   name: 'detail',
   query: {
     id: news.id,
     title: news.title,
     content: news.content
   }
})
```

## 重定向

作用：将特定的路径，重新定向到已有路由。

```js
{
  path: '/',
  redirect: '/home'
}
```
