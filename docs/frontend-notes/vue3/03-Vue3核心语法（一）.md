---
sidebar_position: 3
---

# Vue3 核心语法（一）

## OptionsAPI 与 CompositionAPI

Vue2 的 API 设计是 Options（配置）风格的，Vue3 的 API 设计是 Composition（组合）风格的。

Options API 的弊端：数据、方法、计算属性等，是分散在 `data`、`methods`、`computed` 中的，若想新增或者修改一个需求，就需要分别修改 `data`、`methods`、`computed`，不便于维护和复用。

Composition API 的优势：可以用函数的方式，更加优雅的组织代码，让相关功能的代码更加有序的组织在一起。

## 拉开序幕的 setup

### setup 概述

`setup` 是 `Vue3` 中一个新的配置项，值是一个函数，它是 `Composition API` **“表演的舞台”**，组件中所用到的数据、方法、计算属性、监视等等，均配置在 `setup` 中。

特点如下：

- `setup` 函数返回的对象中的内容，可直接在模板中使用
- `setup` 中访问 `this` 是 `undefined`
- `setup` 函数会在 `beforeCreate` 之前调用，它是“领先”所有钩子执行的

```html
<template>
  <div class="person">
    <h2>姓名：{{ name }}</h2>
    <h2>年龄：{{ age }}</h2>
    <button @click="changeName">修改名字</button>
    <button @click="changeAge">年龄+1</button>
    <button @click="showTel">点我查看联系方式</button>
  </div>
</template>

<script lang="ts">
  export default {
    name: 'Person',
    setup() {
      console.log(this)   // undefined

      // 数据，原来写在 data 中（此时的 name、age、tel 都不是响应式数据）
      let name = '张三'
      let age = 18
      let tel = '13888888888'

      // 方法，原来写在 methods 中
      function changeName() {
        name = 'zhang-san'  // 这么修改 name 页面是不变化的
        console.log(name)
      }
      function changeAge() {
        age += 1            // 这么修改 age 页面是不变化的
        console.log(age)
      }
      function showTel() {
        alert(tel)
      }

      // 返回一个对象，对象中的内容，模板中可以直接使用
      return { name, age, tel, changeName, changeAge, showTel }
    }
  }
</script>
```

### setup 的返回值

- 若返回一个**对象**：则对象中的属性、方法等，在模板中均可以直接使用
- 若返回一个**函数**：则可以自定义渲染内容，如：
    ```ts
    setup() {
      // 返回一个渲染函数
      return () => '你好啊！'
    }
    ```

### setup 与 Options API 的关系

- Options API 中**可以访问**到 `setup` 中的属性和方法，但 `setup` 中**不能访问**到 Options API 中的属性和方法
  - 因为在生命周期中 `setup` 是最先执行的，`setup` 
    执行完成后会把数据挂到 Vue 实例上，而 Options API 中的 `this` 指向的就是 Vue 实例，所以可以访问到
- 如果 Options API 与 `setup` 中的属性或方法有冲突，以 `setup` 为优先

### setup 语法糖

```html
<template>
  <div class="person">
    <h2>姓名：{{ name }}</h2>
    <h2>年龄：{{ age }}</h2>
    <button @click="changName">修改名字</button>
    <button @click="changAge">年龄+1</button>
    <button @click="showTel">点我查看联系方式</button>
  </div>
</template>

<script lang="ts">
  export default {
    name: 'Person',
  }
</script>

<!-- setup 语法糖 -->
<script setup lang="ts">
  console.log(this)   // undefined

  // 数据（此时的 name、age、tel 都不是响应式数据）
  let name = '张三'
  let age = 18
  let tel = '13888888888'

  // 方法
  function changName() {
    name = '李四'   // 这么修改 name 页面是不变化的
  }
  function changAge() {
    console.log(age)
    age += 1        // 这么修改 age 页面是不变化的
  }
  function showTel() {
    alert(tel)
  }
</script>
```

扩展：上述代码，还需要编写一个不写 `setup` 的 `script` 标签，去指定组件名字，比较麻烦，我们可以借助 `vite` 中的插件简化：

1. `npm i vite-plugin-vue-setup-extend -D`
2. `vite.config.ts`
    ```ts
    import { defineConfig } from 'vite'
    import vue from '@vitejs/plugin-vue'
    import VueSetupExtend from 'vite-plugin-vue-setup-extend'
    
    export default defineConfig({
      plugins: [vue(), VueSetupExtend()]
    })
    ```
3. `<script setup lang="ts" name="Person">`

:::tip

Vue3.3+ 提出了 `defineOptions` 函数，可以用来直接在 `<script setup>` 中声明组件选项，而不必使用单独的 `<script>` 块。

```html
<script setup>
defineOptions({
  name: 'Person'
})
</script>
```

:::


